// Generated by CoffeeScript 1.5.0
(function() {
  var OrderProductSelector;

  window.OrderProductSelector = OrderProductSelector = (function() {

    function OrderProductSelector(customerId) {
      this.customerId = customerId;
      this.init();
      this.containerClass = "product-selector";
    }

    OrderProductSelector.prototype.init = function() {
      var sc, _;
      _ = this;
      sc = new window.SuggestControl({
        parentClass: ".product-select",
        triggerClass: ".product-trigger",
        hiddenClass: ".product-id",
        category: "product",
        onSelect: function(line, suggestion) {
          console.log("select: ", suggestion);
          return _.onProductSelect(line, suggestion);
        }
      });
      return sc.init();
    };

    OrderProductSelector.prototype.onProductSelect = function(line, suggestion) {
      var productId, url, _;
      _ = this;
      productId = suggestion.data;
      url = "/api/product/" + productId;
      $.ajax({
        url: url,
        context: document.body,
        dataType: 'json',
        success: function(data) {
          var pcstg;
          if (data) {
            if (data.Colors !== null && data.Sizes !== null) {
              pcstg = new ProductCSTableGenerator(data.Colors, data.Sizes);
              return pcstg.replace("cs-container");
            } else {
              return $("#cs-container").html("ERROR Loading Color&Size information. Product Information Has Errors!");
            }
          }
        },
        error: function(jqXHR, textStatus, errorThrown) {
          return console.log(textStatus);
        }
      });
      url = "/api/customer_price/" + this.customerId + "/" + productId;
      return $.ajax({
        url: url,
        context: document.body,
        dataType: 'json',
        success: function(data) {
          if (data) {
            $("." + _.containerClass + " .price").html(data.price);
            if (data.productPrice - data.price === 0) {
              return $("." + _.containerClass + " .info").html("");
            } else {
              return $("." + _.containerClass + " .info").html(("原价：" + (data.productPrice - data.price)) + "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; √ 已优惠");
            }
          }
        },
        error: function(jqXHR, textStatus, errorThrown) {
          return console.log(textStatus);
        }
      });
    };

    OrderProductSelector.prototype.refresh = function() {};

    return OrderProductSelector;

  })();

}).call(this);
