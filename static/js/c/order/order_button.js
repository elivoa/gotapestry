// Generated by CoffeeScript 1.6.3
(function() {
  var OrderDeliverButton;

  window.OrderDeliverButton = OrderDeliverButton = (function() {
    function OrderDeliverButton(param) {
      console.log(param);
      this.param = param;
      if (!param) {
        this.param = {
          id: "deliverModal"
        };
      }
      this.m = $("#" + this.param.id + "_modal");
      this.init();
      this.initAction();
    }

    OrderDeliverButton.prototype.init = function() {
      $("#" + this.param.id + "_trigger").click($.proxy(function(e) {
        e.preventDefault();
        this.m.on('shown', $.proxy(function() {
          return this.m.find("input.tracking-number").focus();
        }, this));
        return this.m.modal({
          keyboard: true
        });
      }, this));
      return $("#" + this.param.id + "_modal .confirm").click($.proxy(function(e) {
        return this.asyncSubmit();
      }, this));
    };

    OrderDeliverButton.prototype.asyncSubmit = function() {
      var _;
      return 1;
      _ = this;
      _.DeliveryTrackingNumber = $("#" + this.param.id + "_modal .tracking-number").val();
      return $.ajax({
        type: "POST",
        url: "/order/ButtonSubmitHere",
        data: {
          "t:form": "DeliverForm",
          "Order.DeliveryMethod": _.DeliveryMethod,
          "Order.DeliveryTrackingNumber": _.DeliveryTrackingNumber,
          "Order.ExpressFee": _.ExpressFee,
          "Tab": "all"
        },
        success: function(data) {
          console.log("success");
          console.log(data);
          return this.m.modal('hide');
        },
        error: function() {
          return console.log("error occured");
        }
      });
    };

    OrderDeliverButton.prototype.initAction = function() {
      var ef, _;
      _ = this;
      $(".choose_express label").each(function(idx, obj) {
        return $(obj).click(function(e) {
          $(".choose_express label").removeClass('checked');
          $(obj).addClass("checked");
          $(obj).find("input:radio").attr("checked", true);
          return _.DeliveryMethod = $(obj).find("input:radio").val();
        });
      });
      ef = $(".B_fare");
      return ef.find("input:checkbox").click(function(e) {
        if ($(e.target).prop("checked") === true) {
          ef.find("input:text").prop('disabled', true);
          return _.ExpressFee = -1;
        } else {
          ef.find("input:text").prop('disabled', false);
          return _.ExpressFee = ef.find("input:text").val();
        }
      });
    };

    OrderDeliverButton.prototype.setExpress = function(express, expressFee) {
      return $(".choose_express label").each($.proxy(function(idx, obj) {
        var ef;
        if ($(obj).find("input:radio").val().toLowerCase() === express.toLowerCase()) {
          $(obj).addClass('checked');
          $(obj).find("input:radio").attr("checked", true);
        }
        ef = $(".B_fare");
        if (expressFee === -1) {
          ef.find(".express-fee").val(0);
          ef.find("input.daofu").prop('checked', true);
          return ef.find("input:text").prop('disabled', true);
        } else {
          ef.find("express-fee").val(expressFee);
          ef.find("input.daofu").prop('checked', false);
          return ef.find("input:text").prop('disabled', false);
        }
      }, this));
    };

    return OrderDeliverButton;

  })();

}).call(this);
