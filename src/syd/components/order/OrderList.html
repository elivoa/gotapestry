<!DOCTYPE HTML>
<html>
  <head>
    <script type="text/javascript" src="/static/js/c/order/order_list.js"></script>
  </head>
  <body>

    <div id="{{.ClientId}}">
      
      <if t="len .Orders | not">
        <div class="tips_content"><i class="icon_warning"></i> 无记录</div>

        <else t="-------------------------------" />

        <hide t="----- 批量结款 -----">
          {{/* ------------------------------------------------------------------------------------
          <div class="batch_content">
            {{t_order_batchclose $ "Tid" (print .ClientId "_close") "Class" `btn_b_s` "JSInit" `false` "QuickClearButton" `false`}}
          </div>
        </hide>
        
        <table class="tbl_main">
          <tr>
            <th width="10" align="left">
              <input type="checkbox" class="check-all">
            </th> 
            <th align="left">客户</th>
            <th align="left">订单号</th>
            <th align="left">订单金额</th>
            <th align="left">订单状态</th>
            <th align="left">日期</th>
            <th align="left">操作</th>
          </tr>

          <range source=".Orders">
            <tr>
              <td align="left">
                <input type="checkbox" class="order-check"
                       value="{{.TrackNumber}}" CustomerId="{{.CustomerId}}">
              </td>
              <td nowrap>
                <a href="/person/detail/{{.CustomerId}}">{{$.ShowCustomerName .CustomerId}}</a>
              </td>
              <td nowrap>
                <a href="{{$.ViewLink .}}">
                  {{if .TypeIs 1}}<span style="color:red;font-weight:bold;">D</span>{{end}}
                  {{if .TypeIs 2}}<span style="color:#ddd;font-weight:bold;">SUB</span>{{end}}
                  {{.TrackNumber}}
                </a>
              </td>
              <td>
                {{if .IsStatus "todeliver"}}
                <strong class="price">{{.TotalPrice |prettycurrency}}</strong>
                <span class="txt_c">(不含运费)</span>
                {{else}}
                {{if .DeliveryMethodIs "TakeAway"}}<span class="txt_c">(自提)</span>
                {{else}}
                <strong class="price">{{.SumOrderPrice | prettycurrency}}</strong>
                <span class="txt_c">(含运费{{.ExpressFee}}元)</span>
                {{end}}
                {{end}}
              </td>
              <td>{{.DisplayStatus }}</td>
              <td nowrap title="{{.CreateTime | prettytime}} ">
                {{.CreateTime | prettyday}} <!-- formattime "2006-01-02"-->
              </td>
              
              <hide t="~~~~ operation ~~~~" ></hide>
              <td nowrap>

                {{/*
                // Not works because the context is not correct.
                // Context Needed: $, ., $xxx(all variables.), 
                {{if .IsStatus "toprint"}} {{template "order-list-operator-toprint" .}} {{end}}
                {{if .IsStatus "todeliver"}} {{template "order-list-operator-todeliver" .}} {{end}}
                {{if .IsStatus "delivering"}} {{template "order-list-operator-delivering" .}} {{end}}
                {{if .IsStatus "cancelled" "done"}} {{template "order-list-operator-cancelled" .}} {{end}}
                */}}
                
                {{if .IsStatus "toprint"}}
                <a href="{{$.EditLink .}}">修改订单</a><span class="vline">|</span>
                <a href="{{$.PrintOrderLink .}}"
                   onclick="return confirm('打印订单将修改订单状态为代发货，确定打印么？');">打印订单</a>
                <span class="vline">|</span>
                {{end}}


                {{if .IsStatus "todeliver"}}
                <a href="{{$.FixPrintOrderLink .}}">打印订单</a>
                <span class="vline">|</span>
                {{t_order_deliverbutton $ "tid" `deliverBtn` "TrackNumber" .TrackNumber "DeliveryMethod" .DeliveryMethod "DeliveryTrackingNumber" .DeliveryTrackingNumber "ExpressFee" .ExpressFee "Source" (print "/order/list/" $.Tab)}}
                <span class="vline">|</span>
                {{end}}

                {{if .StatusIs "delivering"}}
                {{if .DeliveryMethodIs "TakeAway"}}
                <a href="{{$.FixPrintOrderLink .}}">自提打印订单</a><span class="vline">|</span>

                {{end}}
                {{t_order_closebutton $ "Tid" `CloseButton` "id" (print `close` .TrackNumber `_`) "TrackNumber" .TrackNumber "Source" (print "/order/list/" $.Tab)}}
                {{end}}

                {{if .IsStatus "cancelled" "done"}}  
                <a href="{{$.ViewLink .}}">查看订单</a>
                {{end}}
                {{/*
                <a href="/order/list.orderlist.delete/{{.TrackNumber}}/{{$.Tab}}">[喜小乐可以删除订单]</a>
                */}}            
              </td>
            </tr>
          </range>
        </table>
      </if>

      <script type="text/javascript">
  $(function(){
    orderlist = new OrderList({
      ClientId: {{.ClientId}}
    })
  });
      </script>

    </div>
  </body>
</html>



{{define "--------------" }}
<a href="{{$.EditLink .}}">修改订单</a><span class="vline">|</span>
<a href="{{$.PrintOrderLink .}}" target="_blank">打印订单</a><span class="vline">|</span>
<a href="/order/list.CancelOrder/{{.TrackNumber}}/{{$.Tab}}"
   onclick="return confirm('确定要取消订单么？取消的订单不可撤销！');">取消订单</a>
{{end}}



