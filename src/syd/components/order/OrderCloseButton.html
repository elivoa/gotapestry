{{/*
----------------------------------------------------------------------
CloseOrderModal -- open modal box to close order
---------------------------------------------------------------------------
*/}}

<!-- <script type="text/javascript" src="/static/js/c/order/order_button.js"></script> -->

<a id="{{.Id}}_trigger" href="#{{.Id}}_modal" data-toggle-x="modal">结款</a>

<div id="{{.Id}}_modal" class="layer_box modal hide fade">
  <div class="layer_top modal-header">
    <a class="layer_close" title="关闭" href="#" data-dismiss="modal" aria-hidden="true"></a>
    <span>快速结款</span>
  </div>
  <div class="layer_content L_fast_cash modal-body">

    <form action="/order/ButtonSubmitHere" method="POST" onsubmit="return validateCloseForm('{{.Id}}');">
      <input type="hidden" name="t:id" value="CloseForm" />
      <input type="hidden" name="TrackNumber" value="{{.TrackNumber}}" />      
      <input type="hidden" name="Source" value="{{.Source}}" />
      
	  <div class="L_account_info clearfix">
	    <strong>{{.Customer.Name}}</strong>
	    <span class="L_overage">
          账户余额：
          <span class="price">{{.Customer.AccountBallance | beautycurrency}}</span> 元
        </span>
	  </div>
	  <div class="form_main">
	    <dl class="clearfix">
		  <dt class="L_order_price">订单金额：</dt>
		  <dd>
		    <strong class="price">{{.Order.SumOrderPrice | beautycurrency}}</strong> 元
		  </dd>
	    </dl>
	    <dl class="clearfix">
		  <dt>结账：</dt>
		  <dd>
		    <input type="text" size="16" class="money" name="Money" value=""> 
		    <label><input type="checkbox" class="money-clear"> 已结清</label>
		  </dd>
	    </dl>
	    <dl class="clearfix">
		  <dd>
		    <input type="submit" class="btn_a_s confirm" value="确认" />
		  </dd>
	    </dl>
	  </div>
    </form>
  </div>
</div>
<script type="text/javascript">
  // inline javascript example
  function validateCloseForm(id){
    if (confirm("确认结款么？")){
      o = $("#"+id+"_modal input.money")
      if (o.val() == "") {
        alert('必须填写结账金额！')
        o.focus()
        return false
      }
      return true
    } else{
      return false
    }
  }

$(function(){
  // bind xxx
  trigger = $("#{{.Id}}_trigger")
  m = $("#{{.Id}}_modal")

  // trigger click
  trigger.click(function(e){
    e.preventDefault()
    m.on('shown', function(){
      m.find("input.money").focus()
    });
    m.modal("show")
  })

  // btn
  clearbtn = m.find(".money-clear")
  clearbtn.click(function(){
    if(clearbtn.prop('checked') == true){
      m.find("input.money").val("{{.Order.SumOrderPrice}}")
    }else{
      m.find("input.money").focus()
    }
  })

});
</script>
